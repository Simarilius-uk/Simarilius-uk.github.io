<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title></title>
        <meta name="robots" content="noindex" />


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="introduction.html">Introduction</a></li><li class="chapter-item expanded "><a href="sectors/sectors.html"><strong aria-hidden="true">1.</strong> Sectors</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="sectors/streamingsector.html"><strong aria-hidden="true">1.1.</strong> File Format</a></li><li class="chapter-item expanded "><a href="sectors/naming_chaos.html"><strong aria-hidden="true">1.2.</strong> Names, logic and lack thereof</a></li><li class="chapter-item expanded "><a href="sectors/nodetypes.html"><strong aria-hidden="true">1.3.</strong> Node types</a></li></ol></li><li class="chapter-item expanded "><a href="entities.html"><strong aria-hidden="true">2.</strong> Entities</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="whodat.html"><strong aria-hidden="true">2.1.</strong> Characters</a></li><li class="chapter-item expanded "><a href="sweetride.html"><strong aria-hidden="true">2.2.</strong> Vehicles</a></li></ol></li><li class="chapter-item expanded "><a href="plugin.html"><strong aria-hidden="true">3.</strong> Plugin Stuff</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="materials.html"><strong aria-hidden="true">3.1.</strong> Materials</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="sims-random-ramblings"><a class="header" href="#sims-random-ramblings">Sims Random Ramblings</a></h1>
<p>Wanted somewhere to record some thoughts in a way that was not proper guides for the wiki, where I can ramble and get technical without it being an issue. Expect chatty informal info dumps about mainly Cyberpunk files and importing them to Blender. 
This isnt meant to be a definitive guide to CP2077 formats, its the info I needed/worked out trying to get stuff into blender. Occasional rants are likely, especially if I try to do anything in c#</p>
<p>I will be lazy, and refer to the game Cyberpunk 2077 as cyberpunk or cp2077, unless I specifically say I'm talking about the board game or something else its safe to assume I mean the game.</p>
<h2 id="links"><a class="header" href="#links">Links</a></h2>
<p>My Github is <a href="https://github.com/Simarilius-uk/">here</a></p>
<p>Things of use for cyberpunk/Blender stuff are:</p>
<ul>
<li><a href="https://github.com/Simarilius-uk/CP2077_BlenderScripts">CP2077_BlenderScripts</a> </li>
<li><a href="https://colab.research.google.com/github/Simarilius-uk/sectorStuff/blob/main/AllBlocks_colab_w_streamingblock.ipynb">All blocks jupyter notebook on colab</a></li>
<li><a href="https://github.com/Simarilius-uk/Cyberpunk-Blender-add-on">Latest Plugin work</a></li>
</ul>
<h2 id="guides-more-formal"><a class="header" href="#guides-more-formal">Guides (more formal):</a></h2>
<p><a href="https://wiki.redmodding.org/wolvenkit/modding-community/world-editing/exporting-streaming-sectors-to-blender">Exporting Streaming Sectors</a></p>
<p><a href="https://wiki.redmodding.org/wolvenkit/modding-community/exporting-to-blender">Exporting meshes and characters</a>
<a href="https://wiki.redmodding.org/wolvenkit/modding-community/exporting-to-blender/exporting-rigs-and-anims">Exporting Rigs and Anims</a>
<a href="https://wiki.redmodding.org/wolvenkit/modding-community/exporting-to-blender/exporting-vehicles">Exporting Vehicles</a></p>
<p>Feel free to ping me (simarilius) any q on discord on the <a href="https://discord.com/invite/Epkq79kd96">CP2077 modding server</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="streaming-sectors-what-are-they-how-do-they-work"><a class="header" href="#streaming-sectors-what-are-they-how-do-they-work">Streaming Sectors, what are they, how do they work?</a></h1>
<p>Streaming sectors define the map for cyberpunk, they tell the engine where to put stuff, what should have collisions, what should be interactive. They contain pointers to things that define the people, the traffic, the weather.</p>
<p>All these things are defined in 2 main sections, the <strong>nodes</strong> and the <strong>nodeData</strong>. </p>
<h2 id="nodes"><a class="header" href="#nodes">nodes</a></h2>
<p>The <em>nodes</em><sup class="footnote-reference"><a href="#note">1</a></sup> define the what, meshes, lights, entities, people, its a big list of discrete nodes defining enough info about something for the engine to spawn it. There isnt a discrete id type number, but the nodes can be taken to be a numbered list in the order of definition</p>
<h2 id="nodedata"><a class="header" href="#nodedata">nodeData</a></h2>
<p>The nodeData contains all the where, each node inside the nodeData has a nodeIndex which points back to the <em>nodes</em>
on the simplest node types these nodeData nodes have the postion/orientation/scale info, which mesh appearance to use etc. The more complicated ones get funky, but we'll get to that later.</p>
<h2 id="other-bits"><a class="header" href="#other-bits">other bits</a></h2>
<p>Of course theres more to it than that, sectors have nodeRefs, which links stuff in to quests, they have variants, that let there be multiple versions of a location so the world can change after V swings by and clears out a gang for instance. 
I've not dealt with any of that in the sector import/export yet, so havent dug into it too far, the 2 types of nodes cover pretty much everything I need to do.</p>
<p><sup class="footnote-reference"><a href="#note">1</a></sup> I'm going to put the nodes in italics when I refer to them, as talking about nodeData nodes vs <em>nodes</em> nodes gets really confusing too easily.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="file-structure"><a class="header" href="#file-structure">File Structure</a></h1>
<p>as I said in the overview, the what is defined in the <em>nodes</em> the where is in the nodeData. 
The import script enumerates through the <em>nodes</em> and for each one locates any references to it from the nodeData
This is done with the  instances = [x for x in t if x['NodeIndex'] == i] list comprehensions which are simply finding any node in nodeData that points at the current node being parsed in the <em>nodes</em>.</p>
<p>Theres some fun with shared buffers in a couple of the node types, rather than defining transforms in each nodeData node they have a big list in one node, then link to it from the others.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="names-logic-and-lack-thereof"><a class="header" href="#names-logic-and-lack-thereof">Names, logic and lack thereof</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="node-types"><a class="header" href="#node-types">Node types</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="entities"><a class="header" href="#entities">Entities</a></h1>
<p>Entities are files that define an in game item that uses more than 1 mesh file. People, vehicles, vendingmachines, weapons, all of those should*<sup class="footnote-reference"><a href="#note">1</a></sup> have entities. </p>
<p>Theres a couple of ways they can be defined, and the wiki already explains a bunch of it with nice diagrams and shit for if your modding, I'm just gonna talk about the fun stuff I've run into while doing the importer.</p>
<p>They have 2 important arrays, the <em>appearances</em> and the <em>components</em>. There dont have to be appearances, but most things have them. Basically if theres multiple variations of something chances are theres only 1 entity file and it just has a bunch of appearances defined. So for instance the vending machines, theres 1 ent with about 30 appearances called up. The entries in the appearances are short and sweet, they have a name, an appearanceName and a depotPath to an appearance file that the actual good stuff is in. </p>
<p>The components have the bits that make up the entity. if it doesnt have any appearances defined this will contain everything. If it does have appearances there will still be entries in the components, but its generally non mesh stuff that makes the game work (interaction bits, ui definitions, sounds) and the main list of bits will be in the appearance file components list.</p>
<p>the appearance files have an appearances array, but this has detail in it. each appearance has a components list that like the one in the entity file contains the meshes and stuff that make up the thing.</p>
<p><sup class="footnote-reference"><a href="#note">1</a></sup> should doesnt mean does, some of the weapons only have apps, not worked out how that works.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="characters"><a class="header" href="#characters">Characters</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="vehicles"><a class="header" href="#vehicles">Vehicles</a></h1>
<p>So vehicles are quite frankly a pain in the ass.
The meshes are defined in their own local co-ords, so if you pull them in their just a big jumble of bits that overlap.
Each component has a localTransform property, surely that'll probably fix it? nope, most of those are 0,0,0
they also have a parentTransform property, and thats mostly where you start getting somewhere, but even then things cant be simple. 
I dont know whats wkit and whats the original file structures, as I just mess with the jsons, but the parentTransforms arent actually in the appearance, their in the compiled data and reffed from the appearance by the handleId. So you have to go up from the components, find the chunks, then locate the chunk with the handleId your looking for. 
That gets you a bind name, which if your lucky is a bone in the rig.
If its not that then it might be vehicle_slots, which is a component in the top level ent components, which seems to essentially be a </p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="plugin-stuff"><a class="header" href="#plugin-stuff">Plugin Stuff</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="plugin-materials"><a class="header" href="#plugin-materials">Plugin Materials</a></h1>
<p>The mts currently supported by the plugin (1.3 as of writing) are:</p>
<details><summary><b>engine\\materials\\multilayered.mt</b></summary>
<ul>Processed by multilayer.py
<p>Examples:</p>
<ul>
<li>vs_apartment_wardrobe_a.mesh</li>
<li>neokitsch_carpet_a.mesh</li>
<li>rich_mattress_a_duvet_c.mesh</li>
<li>l1_001_wa_pants__judy.mesh</li>
<li>neokitsch_carpet_a.mesh</li>
</ul>
</ul>
  </details>   
<details><summary><b> base\\materials\\multilayered_terrain.mt </b></summary>
<ul>Processed by multilayerTerrain.py<br>
note the files tend to come in without a UV, which needs mapping before the mat will work.
<p>Examples:</p>
<ul>
<li>terrain_aaayaai_cell_16337_16337.mesh</li>
</ul>
</ul>
  </details>    
<details><summary><b> base\\materials\\multilayered_clear_coat.mt </b></summary>
<ul>not even referenced by the setup.py at the minute</ul>
<ul><details><summary><b> just for maud </b></summary>
<ul>not sure why you need this</ul>
</details></ul>
</details>    
<details><summary><b> base\\materitals\\vehicle_destr_blendshape.mt </b></summary>
<ul>
Vehicle Multilayer with destruction stuff built in. 
Implemented in vehicledestrblendshape.py.
<p>Examples:</p>
<ul>
<li>v_sport2_porsche_911turbo__ext01_body_01.mesh</li>
<li>v_sport2_quadra_type66__ext01_body_01.mesh</li>
</ul>
</ul>
  </details>   
 <details><summary><b>base\\materials\\mesh_decal.mt  </b></summary>
<ul>
Images on mesh, used for stains, stickers etc. Implemented in meshdecal.py
<p>Examples:</p>
<ul>
<li>military_case_a.mesh  (yellow stickers)</li>
<li>destroyed_building_a_wall_l600_b.mesh (generic_destruction.mi)</li>
</ul>
</ul>
</details>   
 <details><summary><b>base\\materials\\mesh_decal_double_diffuse.mt  </b></summary>
</details>   
 <details><summary><b>base\\materials\\vehicle_mesh_decal.mt   </b></summary>
<ul>stickers on cars (aldecados particularly)
can be with alpha or not, switch lets it use the color info for alpha
<p>Examples:</p>
<ul>
<li>v_sport2_quadra_type66_nomad__ext01_hood_01.mesh (speed addicts decal)</li>
<li>v_standard2_thorton_galena_nomad__ext01_door_fr_01.mesh (aldecados on door)</li>
</ul>
</ul>
  </details>   
 <details><summary><b>base\\materials\\vehicle_lights.mt  </b></summary>
<ul>Headlight material, implemented in vehiclelights.py
<p>Examples:</p>
<ul>
<li>v_sport2_porsche_911turbo__ext01_body_01.mesh (headlights and tail lights)</li>
</ul>
</ul>
  </details>   
 <details><summary><b>base\\materials\\skin.mt  </b></summary>
</details>   
 <details><summary><b>engine\\materials\\metal_base.remt   </b></summary>
</details>    
 <details><summary><b>engine\\materials\\metal_base_proxy.mt </b> </summary>
</details>   
 <details><summary><b>base\\materials\\hair.mt </b> </summary>
</details>   
 <details><summary><b>base\\materials\\mesh_decal_gradientmap_recolor.mt  </b></summary>
</details>   
 <details><summary><b>base\\materials\\eye.mt  </b></summary>
</details>   
 <details><summary><b>base\\materials\\eye_gradient.mt </b> </summary>
</details>   
 <details><summary><b>base\\materials\\eye_shadow.mt </b> </summary>
</details>   
 <details><summary><b>base\\materials\\mesh_decal_emissive.mt  </b> </summary>
</details>   
 <details><summary><b>base\\materials\\mesh_decal_wet_character.mt </b> </summary>
</details>   
 <details><summary><b>base\\materials\\glass.mt  </b>  </summary>
</details>   
 <details><summary><b>base\\materials\\vehicle_glass.mt</b> </summary>
</details>    
 <details><summary><b>base\\materials\\glass_deferred.mt  </b></summary>
</details>   
 <details><summary><b>base\\fx\\shaders\\signages.mt </b>  </summary>
</details>   
 <details><summary><b>base\\materials\\glass_onesided.mt   </b> </summary>
</details>   
 <details><summary><b>base\\materials\\vehicle_glass_onesided.mt </b> </summary>
</details>   
 <details><summary><b>base\\materials\\mesh_decal_parallax.mt   </b> </summary>
</details>   
 <details><summary><b>base\\materials\\parallaxscreen.mt  </b> </summary>
</details>   
 <details><summary><b>base\\materials\\speedtree_3d_v8_twosided.mt </b> </summary>
</details>      
 <details><summary><b>base\\materials\\speedtree_3d_v8_onesided.mt    </b></summary>
</details>    
 <details><summary><b>base\\materials\\speedtree_3d_v8_seams.mt </b> </summary>
</details>   
 <details><summary><b>base\\materials\\decal.remt   </b></summary>
</details>   
 <details><summary><b>base\\materials\\decal_roughness.mt  </b> </summary>
</details>   
 <details><summary><b>base\materials\decal_puddle.mt  </b></summary>
</details>   
 <details><summary><b>base\materials\decal_normal_roughness_metalness.mt</b>  </summary>
</details>   
 <details><summary><b>base\\materials\\decal_gradientmap_recolor.mt  </b></summary>
</details>   
                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
